{"version":3,"file":"campaign-3O4g83RQ.js","sources":["../../../src/services/campaign.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { Campaign, CampaignRecipientsResponse, CampaignStatus, CreateCampaignRequest } from '../../types/campaign';\r\nimport env from '../common/env';\r\nimport ajax from './ajax';\r\n\r\ninterface CampaignState {\r\n    campaigns: Campaign[];\r\n    selectedCampaign: Campaign | null;\r\n    isLoading: boolean;\r\n    error: string | null;\r\n    filters: {\r\n        status?: CampaignStatus;\r\n        templateId?: string;\r\n    };\r\n}\r\n\r\ninterface CampaignActions {\r\n    loadCampaigns: (filters?: { status?: string; templateId?: string }) => Promise<void>;\r\n    getCampaignById: (id: string) => Promise<void>;\r\n    createCampaign: (data: CreateCampaignRequest) => Promise<void>;\r\n    pauseCampaign: (id: string) => Promise<void>;\r\n    resumeCampaign: (id: string) => Promise<void>;\r\n    setFilters: (filters: { status?: CampaignStatus; templateId?: string }) => void;\r\n    clearError: () => void;\r\n}\r\n\r\ntype CampaignStore = CampaignState & CampaignActions;\r\n\r\nexport const useCampaignStore = create<CampaignStore>((set, get) => ({\r\n    campaigns: [],\r\n    selectedCampaign: null,\r\n    isLoading: false,\r\n    error: null,\r\n    filters: {},\r\n\r\n    loadCampaigns: async (filters) => {\r\n        set({ isLoading: true, error: null });\r\n        try {\r\n            const params = new URLSearchParams();\r\n            if (filters?.status) params.append('status', filters.status);\r\n            if (filters?.templateId) params.append('templateId', filters.templateId);\r\n\r\n            const response = await ajax.get(`/api/campaigns?${params.toString()}`);\r\n            if (Array.isArray(response)) {\r\n                set({ campaigns: response || [], isLoading: false });\r\n            } else {\r\n                set({ error: response.message || 'Failed to load campaigns', isLoading: false });\r\n            }\r\n        } catch (error: any) {\r\n            set({ error: error.message || 'Failed to load campaigns', isLoading: false });\r\n        }\r\n    },\r\n\r\n    getCampaignById: async (id: string) => {\r\n        set({ isLoading: true, error: null });\r\n        try {\r\n            const campaign = await ajax.get(`/api/campaigns/${id}`);\r\n            set({ selectedCampaign: campaign, isLoading: false });\r\n        } catch (error: any) {\r\n            set({ error: error.message || 'Failed to load campaign', isLoading: false });\r\n        }\r\n    },\r\n\r\n    createCampaign: async (data: CreateCampaignRequest) => {\r\n        set({ isLoading: true, error: null });\r\n        try {\r\n            await ajax.post('/api/campaigns', data);\r\n            await get().loadCampaigns(get().filters);\r\n            set({ isLoading: false });\r\n        } catch (error: any) {\r\n            set({ error: error.message || 'Failed to create campaign', isLoading: false });\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    pauseCampaign: async (id: string) => {\r\n        set({ isLoading: true, error: null });\r\n        try {\r\n            await ajax.post(`/api/campaigns/${id}/pause`, {});\r\n            await get().loadCampaigns(get().filters);\r\n            set({ isLoading: false });\r\n        } catch (error: any) {\r\n            set({ error: error.message || 'Failed to pause campaign', isLoading: false });\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    resumeCampaign: async (id: string) => {\r\n        set({ isLoading: true, error: null });\r\n        try {\r\n            await ajax.post(`/api/campaigns/${id}/resume`, {});\r\n            await get().loadCampaigns(get().filters);\r\n            set({ isLoading: false });\r\n        } catch (error: any) {\r\n            set({ error: error.message || 'Failed to resume campaign', isLoading: false });\r\n            throw error;\r\n        }\r\n    },\r\n\r\n    setFilters: (filters) => {\r\n        set({ filters });\r\n        get().loadCampaigns(filters);\r\n    },\r\n\r\n    clearError: () => set({ error: null }),\r\n}));\r\n\r\nexport async function getCampaignRecipients(\r\n    campaignId: string,\r\n    options?: { status?: string; limit?: number; offset?: number }\r\n): Promise<CampaignRecipientsResponse> {\r\n    const params = new URLSearchParams();\r\n    if (options?.status) params.append('status', options.status);\r\n    if (options?.limit) params.append('limit', options.limit.toString());\r\n    if (options?.offset) params.append('offset', options.offset.toString());\r\n\r\n    return ajax.get(`/api/campaigns/${campaignId}/recipients?${params.toString()}`);\r\n}\r\n\r\nexport function downloadCampaignAnalytics(campaignId: string) {\r\n    const token = sessionStorage.getItem('auth_token');\r\n    const link = document.createElement('a');\r\n    link.href = `${env.API_BASE_URL}/api/campaigns/${campaignId}/export`;\r\n    if (token) {\r\n        link.href += `?token=${token}`;\r\n    }\r\n    link.download = '';\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n}\r\n"],"names":["useCampaignStore","create","set","get","filters","params","response","ajax","error","id","campaign","data","getCampaignRecipients","campaignId","options","downloadCampaignAnalytics","token","link","env"],"mappings":"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"}