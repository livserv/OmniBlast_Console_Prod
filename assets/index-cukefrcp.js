import{r as l,j as e,d as E,B as k,g as _,f as O}from"../index.CMmRcy_I.js";import{u as D,g as $,d as q}from"./campaign-C_k1RUyJ.js";import{L as I}from"./LoadingSpinner-8uHsdOWH.js";import{C as U}from"./CampaignStatusBadge-BlHoQG99.js";const S={pending:"#f59e0b",sending:"#3b82f6",submitted:"#8b5cf6",enqueued:"#6366f1",sent:"#8b5cf6",delivered:"#10b981",read:"#3b82f6",responded:"#ec4899",internally_failed:"#ef4444",externally_failed:"#ef4444",retry_exhausted:"#dc2626"},G={pending:"Pending",sending:"Sending",submitted:"Submitted",enqueued:"Enqueued",sent:"Sent",delivered:"Delivered",read:"Read",responded:"Responded",internally_failed:"Failed",externally_failed:"Failed",retry_exhausted:"Failed"},J=({isOpen:s,onClose:r,triggerElement:o,recipients:d,total:h,loading:c,onLoadMore:b,hasMore:j})=>{const x=l.useRef(null),[y,R]=l.useState({top:0,left:0}),p=l.useRef(null);if(l.useEffect(()=>{if(!s||!o||!x.current)return;const t=()=>{const n=o.getBoundingClientRect(),a=x.current.getBoundingClientRect(),g=window.innerWidth,w=window.innerHeight;let u=n.bottom+8,i=n.left;i+a.width>g&&(i=g-a.width-16),u+a.height>w&&(u=n.top-a.height-8),R({top:u,left:i})};return t(),window.addEventListener("resize",t),window.addEventListener("scroll",t,!0),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t,!0)}},[s,o]),l.useEffect(()=>{if(!s)return;const t=a=>{x.current&&!x.current.contains(a.target)&&!o?.contains(a.target)&&r()},n=a=>{a.key==="Escape"&&r()};return document.addEventListener("mousedown",t),document.addEventListener("keydown",n),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",n)}},[s,r,o]),l.useEffect(()=>{if(!p.current||!j||!b)return;const t=()=>{const{scrollTop:a,scrollHeight:g,clientHeight:w}=p.current;g-a-w<50&&!c&&b()},n=p.current;return n.addEventListener("scroll",t),()=>{n.removeEventListener("scroll",t)}},[j,c,b]),!s)return null;const N=t=>t?new Date(t).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40"}),e.jsxs("div",{ref:x,className:"fixed z-50 bg-white rounded-xl shadow-2xl border border-gray-200 overflow-hidden",style:{top:`${y.top}px`,left:`${y.left}px`,width:"480px",maxHeight:"600px",display:"flex",flexDirection:"column"},children:[e.jsx("div",{className:"px-5 py-4 border-b border-gray-200 bg-linear-to-r from-indigo-50 to-purple-50 shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Recipient Status Details"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Showing ",d.length," of ",h," recipients"]})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-lg hover:bg-white/50",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{ref:p,className:"flex-1 overflow-y-auto",style:{minHeight:"200px",maxHeight:"500px"},children:d.length===0?e.jsx("div",{className:"flex items-center justify-center h-40 text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-12 h-12 mx-auto mb-2 opacity-40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("p",{className:"text-sm",children:"No recipients found"})]})}):e.jsxs("div",{className:"divide-y divide-gray-100",children:[d.map((t,n)=>e.jsx("div",{className:E("px-5 py-3 hover:bg-gray-50 transition-colors",n%2===0?"bg-white":"bg-gray-50/50"),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:t.name||"-"})}),e.jsx("p",{className:"text-xs text-gray-600 font-mono",children:t.mobile}),t.errorMessage&&e.jsx("p",{className:"text-xs text-red-600 mt-1 line-clamp-2",title:t.errorMessage,children:t.errorMessage})]}),e.jsxs("div",{className:"shrink-0 text-right",children:[e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold",style:{backgroundColor:`${S[t.status]||"#6b7280"}15`,color:S[t.status]||"#6b7280"},children:G[t.status]||t.status}),e.jsx("p",{className:"text-xs text-gray-500 mt-1.5",children:N(t.statusDate)})]})]})},t.id)),c&&e.jsx("div",{className:"px-5 py-4 text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 text-sm text-gray-500",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading more..."]})})]})})]})]})},K={email:{label:"Email",icon:"âœ‰ï¸",bgColor:"bg-blue-100",textColor:"text-blue-700",borderColor:"border-blue-200"},gupshup:{label:"Gupshup",icon:"ðŸ’¬",bgColor:"bg-green-100",textColor:"text-green-700",borderColor:"border-green-200"},whatsapp:{label:"WhatsApp",icon:"ðŸ“±",bgColor:"bg-emerald-100",textColor:"text-emerald-700",borderColor:"border-emerald-200"},sms:{label:"SMS",icon:"ðŸ’¬",bgColor:"bg-purple-100",textColor:"text-purple-700",borderColor:"border-purple-200"},telegram:{label:"Telegram",icon:"âœˆï¸",bgColor:"bg-sky-100",textColor:"text-sky-700",borderColor:"border-sky-200"}},Q=({type:s})=>{if(!s)return null;const r=K[s]||{label:s,icon:"ðŸ“¤",bgColor:"bg-gray-100",textColor:"text-gray-700",borderColor:"border-gray-200"};return e.jsxs("span",{className:E("inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium border",r.bgColor,r.textColor,r.borderColor),children:[e.jsx("span",{children:r.icon}),e.jsx("span",{children:r.label})]})},m=({label:s,value:r,color:o,percentage:d,icon:h,onClickDetails:c})=>e.jsxs("div",{className:`relative overflow-hidden rounded-xl bg-linear-to-br from-white to-gray-50 p-4 border border-gray-200 hover:shadow-md transition-shadow ${c&&r>0?"cursor-pointer":""}`,onClick:c&&r>0?c:void 0,children:[h&&e.jsx("div",{className:"absolute top-2 right-2 text-3xl opacity-40 pointer-events-none",style:{color:o},children:h}),e.jsxs("div",{className:"relative",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide mb-1",children:s}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("p",{className:"text-2xl font-bold",style:{color:o},children:r.toLocaleString()}),d&&e.jsxs("span",{className:"text-sm font-medium text-gray-400",children:[d,"%"]})]})]})]}),X=({campaign:s})=>{const{pauseCampaign:r,resumeCampaign:o}=D(),[d,h]=l.useState(!1),[c,b]=l.useState(""),[j,x]=l.useState([]),[y,R]=l.useState(0),[p,N]=l.useState(!1),[t,n]=l.useState(0),a=l.useRef(null),g=async()=>{await r(s.id)},w=async()=>{await o(s.id)},u=l.useCallback(async(f,v=0)=>{N(!0);try{const C=await $(s.id,{status:f,limit:50,offset:v});x(v===0?C.recipients:A=>[...A,...C.recipients]),R(C.total),n(v)}catch(C){console.error("Failed to load recipients:",C)}finally{N(!1)}},[s.id]),i=l.useCallback(f=>v=>{v.stopPropagation(),a.current=v.currentTarget,b(f),h(!0),x([]),n(0),u(f,0)},[u]),M=l.useCallback(()=>{const f=t+50;u(c,f)},[u,c,t]),z=l.useCallback(()=>{h(!1),x([]),n(0)},[]),B=l.useCallback(()=>{q(s.id)},[s.id]),L=s.totalRecipients-s.sent-s.failed,H=L>0,P=s.sent>0?(s.delivered/s.sent*100).toFixed(1):"0",F=s.delivered>0?(s.read/s.delivered*100).toFixed(1):"0",W=s.delivered>0?(s.responded/s.delivered*100).toFixed(1):"0",T=s.totalRecipients>0?((s.sent+s.failed)/s.totalRecipients*100).toFixed(1):"0",V=j.length<y;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl shadow-sm hover:shadow-lg transition-all duration-300 overflow-hidden",children:[e.jsx("div",{className:"bg-linear-to-r from-indigo-50 via-purple-50 to-pink-50 px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-bold text-gray-900 text-xl",children:s.name}),e.jsx(Q,{type:s.integrationType}),e.jsx(U,{status:s.status})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),new Date(s.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})}),T,"% Complete"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"secondary",layout:"plain",size:"sm",leftIcon:_,onClick:B,className:"shadow-sm"}),H&&e.jsxs(e.Fragment,{children:[s.status==="sending"&&e.jsxs(k,{variant:"default",size:"sm",onClick:g,className:"shadow-sm",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}),"Pause"]}),s.status==="paused"&&e.jsxs(k,{variant:"primary",size:"sm",onClick:w,className:"shadow-sm",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})}),"Resume"]})]})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3",children:[e.jsx(m,{label:"Total",value:s.totalRecipients,color:"#6366f1",icon:"ðŸ“Š",onClickDetails:i("all")}),e.jsx(m,{label:"Pending",value:L,color:"#f59e0b",icon:"â³",onClickDetails:i("pending")}),e.jsx(m,{label:"Sent",value:s.sent,color:"#8b5cf6",icon:"ðŸ“¤",onClickDetails:i("sent")}),e.jsx(m,{label:"Delivered",value:s.delivered,color:"#10b981",percentage:P,icon:"âœ“",onClickDetails:i("delivered")}),e.jsx(m,{label:"Read",value:s.read,color:"#3b82f6",percentage:F,icon:"ðŸ‘",onClickDetails:i("read")}),e.jsx(m,{label:"Responded",value:s.responded,color:"#ec4899",percentage:W,icon:"ðŸ’¬",onClickDetails:i("responded")}),e.jsx(m,{label:"Failed",value:s.failed,color:"#ef4444",icon:"âš ",onClickDetails:i("failed")})]})}),e.jsx(J,{isOpen:d,onClose:z,triggerElement:a.current,recipients:j,total:y,loading:p,onLoadMore:M,hasMore:V})]})},Y=({campaigns:s,isLoading:r})=>r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(I,{})}):s.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"No campaigns found"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Create your first campaign to get started"})]}):e.jsx("div",{className:"space-y-4",children:s.map(o=>e.jsx(X,{campaign:o},o.id))}),re=()=>{const s=O(),{loadCampaigns:r,campaigns:o,isLoading:d}=D();return l.useEffect(()=>{r()},[]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Campaigns"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your marketing campaigns"})]}),e.jsx(k,{onClick:()=>s("/campaigns/create"),children:"Create Campaign"})]}),e.jsx(Y,{campaigns:o,isLoading:d})]})};export{re as default};
//# sourceMappingURL=index-cukefrcp.js.map
