import{n as G,c as q,j as e,M as H,B as F,r as x,d as _,p as J,q as Q,e as E,g as K,i as V,m as W,T as X,t as Y,s as Z}from"../index.BVMPhNmP.js";const ee=G(s=>({files:[],isLoading:!1,loadFiles:async n=>{s({isLoading:!0});try{const t=new URLSearchParams(n||{}).toString(),d=t?`/api/files?${t}`:"/api/files",u=await q.get(d);s({files:u.files||u,isLoading:!1})}catch(t){console.error("Load files error:",t),s({isLoading:!1})}},deleteFile:async n=>{await q.delete(`/api/files/${n}`)}})),se=({isOpen:s,onClose:n,onConfirm:t,title:d,message:u,confirmText:g="Confirm",cancelText:p="Cancel",variant:o="danger"})=>{const i=()=>{t(),n()};return e.jsx(H,{isOpen:s,onClose:n,title:d,size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-700",children:u}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(F,{variant:"default",onClick:n,children:p}),e.jsx(F,{variant:o==="danger"?"primary":"default",onClick:i,children:g})]})]})})},te=(s,n,t)=>{if(s.size>n)return`File size exceeds ${Math.round(n/1024/1024)}MB limit`;if(t&&t.length>0){const d=s.name.split(".").pop()?.toLowerCase();if(!d||!t.includes(`.${d}`))return`File type not allowed. Allowed types: ${t.join(", ")}`}return null},ae=(s,n,t,d,u)=>new Promise((g,p)=>{const o=new FormData;o.append("files",s);const i=new XMLHttpRequest;i.upload.addEventListener("progress",a=>{if(a.lengthComputable){const b=Math.round(a.loaded*100/a.total);d(b)}}),i.addEventListener("load",()=>{if(i.status===200){const a=JSON.parse(i.responseText);g(a.files?.[0])}else try{const a=JSON.parse(i.responseText);p(new Error(a.message||a.error||"Upload failed"))}catch{p(new Error("Upload failed"))}}),i.addEventListener("error",()=>{p(new Error("Network error"))}),u.addEventListener("abort",()=>{i.abort(),p(new Error("Upload cancelled"))}),i.open("POST",n),t&&i.setRequestHeader("Authorization",`Bearer ${t}`),i.send(o)}),re=({uploadUrl:s,getAuthToken:n,allowedExtensions:t,maxFileSize:d=50*1024*1024,maxFiles:u=10,onUploadComplete:g,onUploadStart:p,onUploadProgress:o,onUploadError:i,className:a,children:b})=>{const[y,I]=x.useState(!1),[C,L]=x.useState([]),k=x.useRef(null),A=x.useRef(new Map),$=async r=>{const c=`${Date.now()}-${Math.random()}`,N=new AbortController;A.current.set(c,N);const D={id:c,file:r,progress:0,status:"uploading"};L(v=>[...v,D]);try{const v=n?n():null,f=await ae(r,s,v,h=>{L(m=>m.map(l=>l.id===c?{...l,progress:h}:l)),o?.(c,h)},N.signal);return L(h=>h.map(m=>m.id===c?{...m,status:"completed",progress:100}:m)),f}catch(v){const f=v instanceof Error?v.message:"Upload failed";throw L(h=>h.map(m=>m.id===c?{...m,status:"error",error:f}:m)),i?.(c,f),v}finally{A.current.delete(c)}},U=x.useCallback(async r=>{const c=Array.from(r);if(c.length>u){alert(`Maximum ${u} files allowed`);return}const N=[],D=[];if(c.forEach(f=>{const h=te(f,d,t);h?D.push(`${f.name}: ${h}`):N.push(f)}),D.length>0&&alert(`File validation errors:
${D.join(`
`)}`),N.length===0)return;p?.(N);const v=N.map($);try{const h=(await Promise.allSettled(v)).filter(m=>m.status==="fulfilled").map(m=>m.value);h.length>0&&g?.(h),setTimeout(()=>{L(m=>m.filter(l=>l.status==="uploading"))},3e3)}catch(f){console.error("Upload error:",f)}},[u,d,t,p,g,o,i,$]),R=r=>{const c=A.current.get(r);c&&c.abort()},M=r=>{r.preventDefault(),r.stopPropagation(),y||I(!0)},S=r=>{r.preventDefault(),r.stopPropagation(),r.currentTarget===r.target&&I(!1)},w=r=>{r.preventDefault(),r.stopPropagation(),I(!1);const c=r.dataTransfer.files;c.length>0&&U(c)},P=r=>{const c=r.target.files;c&&c.length>0&&U(c),r.target.value=""},T=()=>{k.current?.click()};return e.jsxs("div",{className:a,children:[e.jsxs("div",{className:_("relative border-2 border-dashed rounded-lg transition-all duration-200",{"border-blue-400 bg-blue-50":y,"border-gray-300 hover:border-gray-400":!y}),onDragOver:M,onDragLeave:S,onDrop:w,children:[!b&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(J,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Drop files here to upload"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["or"," ",e.jsx("button",{type:"button",onClick:T,className:"text-blue-600 hover:text-blue-700 font-medium underline",children:"browse from your computer"})]}),t&&e.jsxs("p",{className:"text-xs text-gray-400",children:["Allowed: ",t.join(", ")]}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Max size: ",Math.round(d/1024/1024),"MB per file"]})]})]}),b,C.length>0&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-90 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Uploading Files..."}),e.jsx("div",{className:"space-y-3",children:C.map(r=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-gray-700 truncate",children:r.file.name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[r.status==="uploading"&&`${r.progress}%`,r.status==="completed"&&"Complete",r.status==="error"&&"Error"]}),r.status==="uploading"&&e.jsx("button",{onClick:()=>R(r.id),className:"text-red-500 hover:text-red-700",children:e.jsx(Q,{className:"h-4 w-4"})})]})]}),r.status==="uploading"&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${r.progress}%`}})}),r.status==="error"&&r.error&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:r.error})]},r.id))})]})})]}),e.jsx("input",{ref:k,type:"file",multiple:!0,className:"hidden",onChange:P,accept:t?.join(",")})]})},ne=({file:s,index:n,selectionMode:t,isSelected:d,onFileClick:u,onDownload:g,onDeleteRequest:p,onKeyDown:o,setRef:i})=>e.jsxs("div",{ref:i,tabIndex:0,title:s.originalName,className:_("border rounded-lg p-4 space-y-2 cursor-pointer transition-all outline-none","focus:ring-2 focus:ring-blue-500",{"border-blue-500 bg-blue-50":t&&d,"border-gray-200 hover:border-gray-300":!t||!d,"hover:shadow-md":!t}),onClick:()=>u(s,n),onKeyDown:a=>o(a,n),children:[s.previewType==="image"?e.jsx("img",{src:`${E.API_BASE_URL}/api/files/${s.id}/download`,alt:s.originalName,className:"w-full h-32 object-cover rounded"}):e.jsx("div",{className:"w-full h-32 bg-gray-100 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 text-sm",children:s.extension})}),e.jsx("p",{className:"text-sm font-medium truncate",children:s.originalName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(s.size/1024).toFixed(2)," KB"]}),!t&&e.jsxs("div",{className:"flex gap-2",onClick:a=>a.stopPropagation(),children:[e.jsx(F,{size:"sm",variant:"primary",layout:"plain",leftIcon:K,onClick:a=>{a.stopPropagation(),g(s)}}),e.jsx(F,{size:"sm",variant:"danger",layout:"plain",leftIcon:V,onClick:a=>{a.stopPropagation(),p(s)}})]})]}),le=({files:s,selectionMode:n,selectedFileId:t,onFileClick:d,onDownload:u,onDeleteRequest:g,onKeyDown:p,setFileRef:o,containerRef:i})=>e.jsx("div",{ref:i,className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-1",children:s.map((a,b)=>e.jsx(ne,{file:a,index:b,selectionMode:n,isSelected:t===a.id,onFileClick:d,onDownload:u,onDeleteRequest:g,onKeyDown:p,setRef:o(b)},a.id))}),oe=({file:s,index:n,selectionMode:t,isSelected:d,onFileClick:u,onDownload:g,onDeleteRequest:p,onKeyDown:o,setRef:i})=>e.jsxs("div",{ref:i,tabIndex:0,title:s.originalName,className:_("flex items-center justify-between p-4 border rounded-lg cursor-pointer transition-all outline-none","focus:ring-2 focus:ring-blue-500",{"border-blue-500 bg-blue-50":t&&d,"border-gray-200 hover:border-gray-300":!t||!d}),onClick:()=>u(s,n),onKeyDown:a=>o(a,n),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[s.previewType==="image"?e.jsx("img",{src:`${E.API_BASE_URL}/api/files/${s.id}/download`,alt:s.originalName,className:"w-16 h-16 object-cover rounded"}):e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 text-xs",children:s.extension})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.originalName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(s.size/1024).toFixed(2)," KB • ",s.previewType," • Uploaded ",new Date(s.uploadedAt).toLocaleDateString()]})]})]}),!t&&e.jsxs("div",{className:"flex gap-2 shrink-0",onClick:a=>a.stopPropagation(),children:[e.jsx(F,{size:"sm",variant:"primary",layout:"plain",leftIcon:K,onClick:a=>{a.stopPropagation(),g(s)}}),e.jsx(F,{size:"sm",variant:"danger",layout:"plain",leftIcon:V,onClick:a=>{a.stopPropagation(),p(s)}})]})]}),ie=({files:s,selectionMode:n,selectedFileId:t,onFileClick:d,onDownload:u,onDeleteRequest:g,onKeyDown:p,setFileRef:o})=>e.jsx("div",{className:"space-y-2",children:s.map((i,a)=>e.jsx(oe,{file:i,index:a,selectionMode:n,isSelected:t===i.id,onFileClick:d,onDownload:u,onDeleteRequest:g,onKeyDown:p,setRef:o(a)},i.id))}),ce=[".jpg",".jpeg",".png",".gif",".webp",".mp4",".mov",".avi",".pdf",".docx",".doc",".txt",".csv"],de=50*1024*1024,ue=[{label:"All Types",value:""},{label:"Images",value:"image"},{label:"Videos",value:"video"},{label:"Documents",value:"document"},{label:"CSV",value:"csv"}],me=({selectionMode:s=!1,onFileSelect:n,fileType:t,showUpload:d=!1,showViewToggle:u=!1,showSearch:g=!0,showFilter:p=!1})=>{const{files:o,isLoading:i,loadFiles:a,deleteFile:b}=ee(),[y,I]=x.useState("grid"),[C,L]=x.useState(""),[k,A]=x.useState(""),[$,U]=x.useState(null),[R,M]=x.useState(null),[S,w]=x.useState(0),P=x.useRef(null),T=x.useRef([]);x.useEffect(()=>{a({search:C,previewType:t||k})},[C,k,t]),x.useEffect(()=>{T.current=T.current.slice(0,o.length)},[o]),x.useEffect(()=>{S>=0&&S<o.length&&T.current[S]?.focus()},[S,o.length]);const r=()=>{a({search:C,previewType:t||k})},c=l=>{M(l)},N=async()=>{try{R&&(await b(R.id),a({search:C,previewType:t||k}),M(null))}catch{Z("Unable to delete selected files","Delete failed")}},D=l=>{window.open(`${E.API_BASE_URL}/api/files/${l.id}/download`,"_blank")},v=()=>{if(!P.current)return 4;const l=P.current.offsetWidth;return l>=1024?4:l>=768?3:2},f=(l,j)=>{const z=o[j];switch(l.key){case"ArrowRight":l.preventDefault(),y==="grid"&&w(Math.min(o.length-1,j+1));break;case"ArrowLeft":l.preventDefault(),y==="grid"&&w(Math.max(0,j-1));break;case"ArrowDown":if(l.preventDefault(),y==="grid"){const B=v(),O=Math.min(o.length-1,j+B);w(O)}else w(Math.min(o.length-1,j+1));break;case"ArrowUp":if(l.preventDefault(),y==="grid"){const B=v(),O=Math.max(0,j-B);w(O)}else w(Math.max(0,j-1));break;case"Enter":l.preventDefault(),s&&n?n(z):D(z);break;case"Delete":l.preventDefault(),s||c(z);break}},h=(l,j)=>{w(j),s&&(U(l.id),n&&n(l))},m=l=>j=>{T.current[l]=j};return e.jsxs("div",{className:"space-y-6",children:[d&&e.jsx(re,{uploadUrl:`${E.API_BASE_URL}/api/files/upload`,getAuthToken:W,allowedExtensions:ce,maxFileSize:de,onUploadComplete:r}),(g||p||u)&&e.jsxs("div",{className:"flex items-center gap-4",children:[g&&e.jsx(X,{placeholder:"Search files...",value:C,onChange:l=>L(l.value),className:"flex-1"}),p&&e.jsx("div",{className:"min-w-50",children:e.jsx(Y,{options:ue,value:k,onChange:l=>A(l.value)})}),u&&e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx(F,{variant:y==="grid"?"primary":"default",size:"sm",onClick:()=>I("grid"),children:"Grid"}),e.jsx(F,{variant:y==="tile"?"primary":"default",size:"sm",onClick:()=>I("tile"),children:"List"})]})]}),i?e.jsx("div",{className:"text-center py-12",children:"Loading..."}):o.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No files found"}):y==="grid"?e.jsx(le,{files:o,selectionMode:s,selectedFileId:$,onFileClick:h,onDownload:D,onDeleteRequest:c,onKeyDown:f,setFileRef:m,containerRef:P}):e.jsx(ie,{files:o,selectionMode:s,selectedFileId:$,onFileClick:h,onDownload:D,onDeleteRequest:c,onKeyDown:f,setFileRef:m}),e.jsx(se,{isOpen:!!R,onClose:()=>M(null),onConfirm:N,title:"Delete File",message:`Are you sure you want to delete "${R?.originalName}"? This action cannot be undone.`,confirmText:"Delete",variant:"danger"})]})};export{me as M};
