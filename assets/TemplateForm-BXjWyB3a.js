import{j as e,f as S,v as A,r as m,B as c,D as x,l as h}from"../index.BVMPhNmP.js";import{L as B}from"./LoadingSpinner-6bdEt-iZ.js";import{u as k}from"./integration-D5ip6qWV.js";import{u as D}from"./template-CPwLbm6E.js";const U=({template:i})=>e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Message Preview"}),e.jsx("div",{className:"bg-white border rounded-lg p-4 max-w-sm",children:i.components?.map((l,s)=>e.jsxs("div",{className:"mb-3 last:mb-0",children:[l.type==="HEADER"&&e.jsx("div",{className:"font-semibold text-gray-900 text-sm mb-2",children:l.text}),l.type==="BODY"&&e.jsx("div",{className:"text-gray-800 text-sm mb-2 whitespace-pre-wrap",children:l.text}),l.type==="FOOTER"&&e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:l.text}),l.type==="BUTTONS"&&l.buttons&&e.jsx("div",{className:"space-y-1",children:l.buttons.map((p,g)=>e.jsx("div",{className:"bg-blue-50 text-blue-700 px-3 py-1 rounded text-xs border border-blue-200 text-center",children:p.text},g))})]},s))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"JSON Structure"}),e.jsx("div",{className:"bg-gray-900 text-gray-100 rounded-lg p-4 text-xs font-mono overflow-x-auto max-h-96 overflow-y-auto",children:e.jsx("pre",{children:JSON.stringify({name:i.name,language:i.language,category:i.category,components:i.components,metadata:i.metadata},null,2)})})]})]}),L=()=>{const i=S(),{id:l}=A(),s=!!l,{createTemplate:p,updateTemplate:g,getTemplateById:b,selectedTemplate:n,isLoading:u}=D(),{loadIntegrations:v,integrations:j}=k(),[t,o]=m.useState({integrationId:"",type:"gupshup",name:"",displayName:"",category:"MARKETING",language:"en",components:[]}),[r,y]=m.useState({type:"BODY",text:""});m.useEffect(()=>{v(),s&&l&&b(l)},[l]),m.useEffect(()=>{s&&n&&o({integrationId:n.integrationId,type:n.type,name:n.name,displayName:n.displayName,category:n.category||"MARKETING",language:n.language,components:n.components})},[n,s]);const N=[{label:"Marketing",value:"MARKETING"},{label:"Utility",value:"UTILITY"},{label:"Authentication",value:"AUTHENTICATION"}],f=[{label:"Header",value:"HEADER"},{label:"Body",value:"BODY"},{label:"Footer",value:"FOOTER"},{label:"Buttons",value:"BUTTONS"}],T=[{label:"English",value:"en"},{label:"Spanish",value:"es"},{label:"French",value:"fr"},{label:"German",value:"de"},{label:"Hindi",value:"hi"}],w=j.filter(a=>a.isActive).map(a=>({label:a.name,value:a.id})),C=()=>{r.type&&r.text&&(o({...t,components:[...t.components,r]}),y({type:"BODY",text:""}))},I=a=>{o({...t,components:t.components.filter((d,O)=>O!==a)})},E=async a=>{a.preventDefault();try{s&&l?await g(l,{displayName:t.displayName,category:t.category,components:t.components}):await p(t),i("/templates")}catch(d){console.error("Failed to save template:",d)}};return s&&!n&&u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(B,{})}):s&&!n?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"Template not found"})}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s?"Edit Template":"Create Template"}),e.jsx("p",{className:"text-gray-600 mt-1",children:s?t.name:"Build a new message template"})]}),e.jsx(c,{variant:"default",onClick:()=>i("/templates"),children:"Cancel"})]}),e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Template Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Integration *"}),e.jsx(x,{options:w,value:t.integrationId,onChange:a=>o({...t,integrationId:a.value}),placeholder:"Select integration",disabled:s})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Name *"}),e.jsx(h,{value:t.name,onChange:a=>o({...t,name:a.value}),placeholder:"e.g., welcome_new_user",disabled:s}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use lowercase, numbers, and underscores only"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Display Name *"}),e.jsx(h,{value:t.displayName,onChange:a=>o({...t,displayName:a.value}),placeholder:"Welcome New User"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),e.jsx(x,{options:N,value:t.category,onChange:a=>o({...t,category:a.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Language *"}),e.jsx(x,{options:T,value:t.language,onChange:a=>o({...t,language:a.value}),disabled:s})]}),s&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"Note: Template name, language, and integration cannot be changed after creation."})})]}),!s&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Add Components"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Component Type"}),e.jsx(x,{options:f,value:r.type||"",onChange:a=>y({...r,type:a.value}),placeholder:"Select type"})]}),r.type&&r.type!=="BUTTONS"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Text"}),e.jsx("textarea",{rows:3,value:r.text||"",onChange:a=>y({...r,text:a.target.value}),placeholder:"Enter text... Use {{1}}, {{2}} for variables",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Use ","{{1}}, {{2}}"," for dynamic variables"]})]}),e.jsx(c,{type:"button",onClick:C,disabled:!r.type||!r.text,children:"Add Component"}),t.components.length>0&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Added Components"}),t.components.map((a,d)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:a.type}),a.text&&e.jsx("p",{className:"text-xs text-gray-600 mt-1 truncate max-w-xs",children:a.text})]}),e.jsx(c,{variant:"default",size:"sm",type:"button",onClick:()=>I(d),children:"Remove"})]},d))]})]})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Preview"}),t.components.length>0?e.jsx(U,{template:t}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Add components to see preview"})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx(c,{type:"button",variant:"default",onClick:()=>i("/templates"),children:"Cancel"}),e.jsx(c,{type:"submit",disabled:u||!t.integrationId||!t.name||t.components.length===0,children:u?s?"Updating...":"Creating...":s?"Update Template":"Create Template"})]})]})]})};export{L as TemplateForm,L as default};
